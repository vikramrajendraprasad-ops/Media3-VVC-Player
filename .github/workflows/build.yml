- name: ðŸ›¡ï¸ Inject UI & Force Render Bridge
        run: |
          ACTIVITY=$(find media/demos/main -name "SampleChooserActivity.java" | head -n 1)

          # 1. Inject The Purple Button (UI)
          sed -i '/import android.widget.Button;/d' "$ACTIVITY"
          sed -i '/setContentView/a \
            android.widget.Button proBtn = new android.widget.Button(this);\
            proBtn.setText("ðŸ“‚ OPEN LOCAL FILE (VVC/APV)");\
            proBtn.setBackgroundColor(0xFF6200EE);\
            proBtn.setTextColor(0xFFFFFFFF);\
            proBtn.setPadding(30, 30, 30, 30);\
            proBtn.setOnClickListener(v -> {\
                android.content.Intent intent = new android.content.Intent(android.content.Intent.ACTION_OPEN_DOCUMENT);\
                intent.addCategory(android.content.Intent.CATEGORY_OPENABLE);\
                intent.setType("*/*");\
                startActivityForResult(intent, 1001);\
            });\
            android.widget.FrameLayout.LayoutParams params = new android.widget.FrameLayout.LayoutParams(\
                android.view.ViewGroup.LayoutParams.MATCH_PARENT,\
                200\
            );\
            params.gravity = android.view.Gravity.TOP;\
            addContentView(proBtn, params);' "$ACTIVITY"

          # 2. Inject The Force Render Bridge Logic
          python3 - <<EOF
          import os
          path = '$ACTIVITY'
          if os.path.exists(path):
              with open(path, 'r') as f:
                  content = f.read()
              last_brace = content.rfind('}')
              
              # This version forces the Intent to include MediaItem data that the 
              # PlayerActivity needs to initialize the renderers properly
              bridge_logic = '''
              @Override
              public void onActivityResult(int requestCode, int resultCode, android.content.Intent data) {
                  super.onActivityResult(requestCode, resultCode, data);
                  if (requestCode == 1001 && resultCode == RESULT_OK && data != null && data.getData() != null) {
                      android.net.Uri uri = data.getData();
                      
                      // Create the intent for PlayerActivity
                      android.content.Intent playerIntent = new android.content.Intent(this, androidx.media3.demo.main.PlayerActivity.class);
                      
                      # Set the action to VIEW to satisfy the Demo App checks
                      playerIntent.setAction("android.intent.action.VIEW");
                      playerIntent.setData(uri);
                      playerIntent.addFlags(android.content.Intent.FLAG_GRANT_READ_URI_PERMISSION);
                      
                      # CRITICAL: Force the player to use extension decoders and auto-play
                      playerIntent.putExtra("prefer_extension_decoders", true);
                      playerIntent.putExtra("force_default_track_selector", true);
                      
                      # These extras simulate clicking a 'sample' from the list
                      playerIntent.putExtra("uri", uri.toString());
                      playerIntent.putExtra("title", "Pro Player: " + uri.getLastPathSegment());
                      
                      startActivity(playerIntent);
                  }
              }
              '''
              if last_brace != -1:
                  new_content = content[:last_brace] + bridge_logic + content[last_brace:]
                  with open(path, 'w') as f:
                      f.write(new_content)
          EOF
